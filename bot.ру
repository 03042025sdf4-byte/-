import logging
import re
import os
from aiogram import Bot, Dispatcher, executor, types

API_TOKEN = os.getenv("8475002362:AAHtx03EBMUl6T4wUNROyrN23kpuLtOaHT0")  # Токен берём из переменных окружения

logging.basicConfig(level=logging.INFO)

bot = Bot(token=API_TOKEN)
dp = Dispatcher(bot)

# Глобальная сумма (в реальном проекте лучше хранить в БД или файле)
total_sum = 0

def extract_numbers(text: str):
    numbers = []
    for line in text.splitlines():
        match = re.match(r"^([+-]?\d+)", line.strip())
        if match:
            numbers.append(int(match.group(1)))
    return numbers

@dp.message_handler()
async def handle_message(message: types.Message):
    global total_sum
    if not message.text:
        return
    numbers = extract_numbers(message.text)
    if numbers:
        add_sum = sum(numbers)
        total_sum += add_sum
        await message.answer(f"Добавлено {add_sum}. Текущая сумма: {total_sum}")

if __name__ == "__main__":
    executor.start_polling(dp, skip_updates=True)
    
